module.exports = class Data1663751796437 {
  name = 'Data1663751796437'

  async up(db) {
    await db.query(`CREATE TABLE "sale" ("id" character varying NOT NULL, "tx_hash" text NOT NULL, "amount" numeric NOT NULL, "bought_with_credits" boolean NOT NULL, "timestamp" numeric NOT NULL, "block" integer NOT NULL, "buyer_id" character varying NOT NULL, "referrer_id" character varying NOT NULL, CONSTRAINT "PK_d03891c457cbcd22974732b5de2" PRIMARY KEY ("id"))`)
    await db.query(`CREATE INDEX "IDX_2296c3d55ec8891ef2be15d341" ON "sale" ("buyer_id") `)
    await db.query(`CREATE INDEX "IDX_21dfbb45047889bfac1afe4578" ON "sale" ("referrer_id") `)
    await db.query(`CREATE TABLE "referrer" ("id" character varying NOT NULL, CONSTRAINT "PK_6af2ce99a84db81dbb3622a7335" PRIMARY KEY ("id"))`)
    await db.query(`CREATE TABLE "plot_operation_record" ("id" character varying NOT NULL, "tx_hash" text NOT NULL, "block" integer NOT NULL, "timestamp" numeric NOT NULL, "type" text NOT NULL, "price" numeric, "plot_id" character varying NOT NULL, "operator_id" character varying NOT NULL, "receiver_id" character varying, CONSTRAINT "PK_1107596a525508794ed841da53f" PRIMARY KEY ("id"))`)
    await db.query(`CREATE INDEX "IDX_f630eb732964b68e85318f4090" ON "plot_operation_record" ("plot_id") `)
    await db.query(`CREATE INDEX "IDX_830e82c0fd0034604088c35c77" ON "plot_operation_record" ("operator_id") `)
    await db.query(`CREATE INDEX "IDX_1d87a905b9f1339c13761ece8c" ON "plot_operation_record" ("receiver_id") `)
    await db.query(`CREATE TABLE "plot" ("id" character varying NOT NULL, "plot_id" numeric NOT NULL, "data" jsonb NOT NULL, "last_modified_block" integer NOT NULL, "last_modified_time" numeric NOT NULL, "buyer_id" character varying NOT NULL, "referrer_id" character varying NOT NULL, "sale_id" character varying NOT NULL, CONSTRAINT "PK_7c22bdc3280a3a5610c63159883" PRIMARY KEY ("id"))`)
    await db.query(`CREATE INDEX "IDX_941e6f8e227f6123eca097dd7d" ON "plot" ("buyer_id") `)
    await db.query(`CREATE INDEX "IDX_ac0a37eb18459786d1d72c58bf" ON "plot" ("referrer_id") `)
    await db.query(`CREATE INDEX "IDX_08cb1005b49aba2c3a6375bc19" ON "plot" ("sale_id") `)
    await db.query(`CREATE TABLE "buyer" ("id" character varying NOT NULL, CONSTRAINT "PK_0480fc3c7289846a31b8e1bc503" PRIMARY KEY ("id"))`)
    await db.query(`ALTER TABLE "sale" ADD CONSTRAINT "FK_2296c3d55ec8891ef2be15d341d" FOREIGN KEY ("buyer_id") REFERENCES "buyer"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`)
    await db.query(`ALTER TABLE "sale" ADD CONSTRAINT "FK_21dfbb45047889bfac1afe4578c" FOREIGN KEY ("referrer_id") REFERENCES "referrer"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`)
    await db.query(`ALTER TABLE "plot_operation_record" ADD CONSTRAINT "FK_f630eb732964b68e85318f40908" FOREIGN KEY ("plot_id") REFERENCES "plot"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`)
    await db.query(`ALTER TABLE "plot_operation_record" ADD CONSTRAINT "FK_830e82c0fd0034604088c35c777" FOREIGN KEY ("operator_id") REFERENCES "buyer"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`)
    await db.query(`ALTER TABLE "plot_operation_record" ADD CONSTRAINT "FK_1d87a905b9f1339c13761ece8c9" FOREIGN KEY ("receiver_id") REFERENCES "buyer"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`)
    await db.query(`ALTER TABLE "plot" ADD CONSTRAINT "FK_941e6f8e227f6123eca097dd7d9" FOREIGN KEY ("buyer_id") REFERENCES "buyer"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`)
    await db.query(`ALTER TABLE "plot" ADD CONSTRAINT "FK_ac0a37eb18459786d1d72c58bfd" FOREIGN KEY ("referrer_id") REFERENCES "referrer"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`)
    await db.query(`ALTER TABLE "plot" ADD CONSTRAINT "FK_08cb1005b49aba2c3a6375bc19b" FOREIGN KEY ("sale_id") REFERENCES "sale"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`)
  }

  async down(db) {
    await db.query(`DROP TABLE "sale"`)
    await db.query(`DROP INDEX "public"."IDX_2296c3d55ec8891ef2be15d341"`)
    await db.query(`DROP INDEX "public"."IDX_21dfbb45047889bfac1afe4578"`)
    await db.query(`DROP TABLE "referrer"`)
    await db.query(`DROP TABLE "plot_operation_record"`)
    await db.query(`DROP INDEX "public"."IDX_f630eb732964b68e85318f4090"`)
    await db.query(`DROP INDEX "public"."IDX_830e82c0fd0034604088c35c77"`)
    await db.query(`DROP INDEX "public"."IDX_1d87a905b9f1339c13761ece8c"`)
    await db.query(`DROP TABLE "plot"`)
    await db.query(`DROP INDEX "public"."IDX_941e6f8e227f6123eca097dd7d"`)
    await db.query(`DROP INDEX "public"."IDX_ac0a37eb18459786d1d72c58bf"`)
    await db.query(`DROP INDEX "public"."IDX_08cb1005b49aba2c3a6375bc19"`)
    await db.query(`DROP TABLE "buyer"`)
    await db.query(`ALTER TABLE "sale" DROP CONSTRAINT "FK_2296c3d55ec8891ef2be15d341d"`)
    await db.query(`ALTER TABLE "sale" DROP CONSTRAINT "FK_21dfbb45047889bfac1afe4578c"`)
    await db.query(`ALTER TABLE "plot_operation_record" DROP CONSTRAINT "FK_f630eb732964b68e85318f40908"`)
    await db.query(`ALTER TABLE "plot_operation_record" DROP CONSTRAINT "FK_830e82c0fd0034604088c35c777"`)
    await db.query(`ALTER TABLE "plot_operation_record" DROP CONSTRAINT "FK_1d87a905b9f1339c13761ece8c9"`)
    await db.query(`ALTER TABLE "plot" DROP CONSTRAINT "FK_941e6f8e227f6123eca097dd7d9"`)
    await db.query(`ALTER TABLE "plot" DROP CONSTRAINT "FK_ac0a37eb18459786d1d72c58bfd"`)
    await db.query(`ALTER TABLE "plot" DROP CONSTRAINT "FK_08cb1005b49aba2c3a6375bc19b"`)
  }
}
